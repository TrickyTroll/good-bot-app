<!doctype html>
<html>
	<head>
		<title>New video</title>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
		<link rel="stylesheet" type="text/css" href="/static/css/main.css"/>
	</head>
	<body>

		<div>
			<div>
				<p>
					{{.Title}}
				</p>
			</div>
        <div>
			<div id="editor" style="width:800px;height:600px;">
			</div>
			<button 
			id="submit-form"
			onclick="save()">
			Submit
			</button>
			</div>

		<script>
			var require = {
				paths: {
					'vs': '/node_modules/monaco-editor/min/vs',
				}
			};
		</script>
		<script src="/node_modules/monaco-editor/min/vs/loader.js"></script>
		<script>
			require.config({ paths: { 'vs': '/node_modules/monaco-editor/min/vs' }});
			require(['vs/editor/editor.main'], function() {
				window.editor = monaco.editor.create(document.getElementById('editor'), {
					value: [
						'1:',
						'\t- commands:',
						'\t\t- Write your script here.'
					].join('\n'),
					language: 'yaml'
				});
			});

			function post(path, params, method='post') {

			  // The rest of this code assumes you are not using a library.
			  // It can be made less verbose if you use one.
			  const form = document.createElement('form');
			  form.method = method;
			  form.action = path;

			  for (const key in params) {
			    if (params.hasOwnProperty(key)) {
			      const hiddenField = document.createElement('input');
			      hiddenField.type = 'hidden';
			      hiddenField.name = key;
			      hiddenField.value = params[key];

			      form.appendChild(hiddenField);
			    }
			  }
			  document.body.appendChild(form);
  			  form.submit();
			}
			function save() {
				var value = window.editor.getValue()
				console.log("Saving: \n%s.", value)
				post("/save/{{.Title}}", {body: value});

			}
		</script>
	</div>
	</body>
</html>
