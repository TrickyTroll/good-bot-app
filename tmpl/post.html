<!doctype html>
<html>
	<head>
		<title>New project</title>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
		<link rel="stylesheet" type="text/css" href="/static/css/output.css"/>
	</head>
	<body class="bg-purple-200">

		<div class="container mx-auto">
			<div class="conatiner-fluid p-2 m-4">
				<p class="uppercase text-center font-semibold text-4xl font-mono text-gray-600">
					{{.Title}}
				</p>
			</div>
        <div class="grid grid-cols-1 place-items-center">
			<div id="editor" style="width:800px;height:600px;">
			</div>
			<button 
			class="bg-purple-400 m-4 shadow-xl font-mono text-gray-600 h-16 w-40 rounded-lg hover:bg-purple-600 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-opacity-50 hover:text-gray-200 btn btn-primary"
			id="submit-form"
			onclick="save()">
			Submit
			</button>
        </div>

		<script>
			var require = {
				paths: {
					'vs': '/node_modules/monaco-editor/min/vs',
				}
			};
		</script>
		<script src="/node_modules/monaco-editor/min/vs/loader.js"></script>
		<script>
			require.config({ paths: { 'vs': '/node_modules/monaco-editor/min/vs' }});
			require(['vs/editor/editor.main'], function() {
				window.editor = monaco.editor.create(document.getElementById('editor'), {
					value: [
						'1:',
						'\t- commands:',
						'\t\t- Write your script here.'
					].join('\n'),
					language: 'yaml'
				});
			});

			function save() {
				var value = window.editor.getValue()
				const postData = async ( url = '/save/{{.Title}}', data = value)=>{
					console.log(data);
					  const response = await fetch(url, {
					  method: 'POST', 
					  credentials: 'same-origin',
					  headers: {
						  'Content-Type': 'application/json',
					  },
					  body: JSON.stringify(data), 
					});

					  try {
						const newData = await response.json();
						console.log(newData);
						return newData;
					  }catch(error) {
					  console.log("error", error);
					  }
				  }
				postData()
			}
		</script>
	</div>
	</body>
</html>
